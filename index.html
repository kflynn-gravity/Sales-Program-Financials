<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Financial Scenarios</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-5xl w-full mx-auto my-8">
        <!-- Chart Title -->
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-6">Financial Scenarios: Cost vs. Cumulative Revenue</h1>
        
        <!-- Chart Container -->
        <div class="relative h-[500px] w-full">
            <canvas id="cumulativeChart"></canvas>
            <!-- Dynamic text box for descriptions -->
            <div id="infoBox" class="absolute top-4 left-4 p-4 bg-gray-100 rounded-lg shadow-md text-gray-700 w-64 hidden"></div>
        </div>

        <!-- Chart Description -->
        <div class="mt-8 text-center text-gray-600">
            <p class="text-lg">This chart compares the **total cumulative cost** of the program against the **total cumulative revenue** for three different performance models over a one-year period. The model assumes a cohort of 10 associates for the entire year. Click on the legend items to explore each scenario.</p>
        </div>
    </div>

    <!-- Chart.js Library and Annotation Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

    <script>
        const monthlyCost = 34640;
        const idealRevenuePerMonth = 24000;
        const likelyRevenuePerMonth = 16000;
        const poorRevenuePerMonth = 8000;
        const ambiguousRevenuePerMonth = [6000, 18000, 10000, 22000, 14000, 25000, 12000, 28000, 15000, 30000, 18000, 35000];

        const labels = ['Month 1', 'Month 2', 'Month 3', 'Month 4', 'Month 5', 'Month 6', 'Month 7', 'Month 8', 'Month 9', 'Month 10', 'Month 11', 'Month 12'];

        const cumulativeCostData = labels.map((_, i) => (i + 1) * monthlyCost);

        const cumulativeIdealRevenueData = labels.map((_, i) => {
            let total = 0;
            for (let j = 0; j <= i; j++) {
                total += idealRevenuePerMonth * (j + 1);
            }
            return total;
        });

        const cumulativeLikelyRevenueData = labels.map((_, i) => {
            let total = 0;
            for (let j = 0; j <= i; j++) {
                total += likelyRevenuePerMonth * (j + 1);
            }
            return total;
        });

        const cumulativePoorRevenueData = labels.map((_, i) => {
            let total = 0;
            for (let j = 0; j <= i; j++) {
                total += poorRevenuePerMonth * (j + 1);
            }
            return total;
        });
        
        const cumulativeAmbiguousRevenueData = labels.map((_, i) => {
            let total = 0;
            for (let j = 0; j <= i; j++) {
                total += ambiguousRevenuePerMonth[j] * (j + 1);
            }
            return total;
        });


        const infoBox = document.getElementById('infoBox');
        
        const breakEvenPoints = {
            'Ideal Model (3/week)': 2, // Month 2
            'Likely Model (2/week)': 4, // Month 4
            'Poor Model (1/week)': 8, // Month 8
            'Ambiguous Model': 4 // Month 4
        };

        const chartConfig = {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Cumulative Costs',
                    data: cumulativeCostData,
                    borderColor: 'rgb(248, 113, 113)',
                    backgroundColor: 'rgba(248, 113, 113, 0.5)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.1
                }, {
                    label: 'Ideal Model (3/week)',
                    data: cumulativeIdealRevenueData,
                    borderColor: 'rgb(34, 197, 94)',
                    backgroundColor: 'rgba(34, 197, 94, 0.5)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.1
                }, {
                    label: 'Likely Model (2/week)',
                    data: cumulativeLikelyRevenueData,
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.1
                }, {
                    label: 'Poor Model (1/week)',
                    data: cumulativePoorRevenueData,
                    borderColor: 'rgb(251, 191, 36)',
                    backgroundColor: 'rgba(251, 191, 36, 0.5)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.1
                }, {
                    label: 'Ambiguous Model',
                    data: cumulativeAmbiguousRevenueData,
                    borderColor: 'rgb(108, 117, 125)', // Custom dark grey
                    backgroundColor: 'rgba(108, 117, 125, 0.5)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Cumulative Value ($)',
                            font: { size: 16, weight: 'bold' }
                        },
                        ticks: {
                            callback: function(value) { return '$' + value.toLocaleString(); }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Timeline',
                            font: { size: 16, weight: 'bold' }
                        }
                    }
                },
                plugins: {
                    legend: {
                        onClick: (e, legendItem, legend) => {
                            Chart.defaults.plugins.legend.onClick(e, legendItem, legend);
                            updateChartAnnotations(legend.chart);
                        },
                         onHover: (e, legendItem, legend) => {
                            const chart = legend.chart;
                            const label = legendItem.text;
                            if (label !== 'Cumulative Costs') {
                                updateChartAnnotations(chart, label);
                            }
                        },
                        onLeave: (e, legendItem, legend) => {
                            const chart = legend.chart;
                            resetChartAnnotations(chart);
                        }
                    },
                    tooltip: {
                        callbacks: {
                             label: function(context) {
                                let label = context.dataset.label || '';
                                let newAccounts;
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    // Calculate new accounts for the month
                                    const monthIndex = context.dataIndex;
                                    const prevRevenue = monthIndex > 0 ? context.dataset.data[monthIndex - 1] : 0;
                                    const newMonthlyRevenue = context.parsed.y - prevRevenue;
                                    newAccounts = Math.round(newMonthlyRevenue / 200);

                                    label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                                }
                                return `${label} (${newAccounts} new accounts)`;
                            }
                        }
                    },
                    annotation: {
                        annotations: []
                    }
                }
            }
        };

        const ctx = document.getElementById('cumulativeChart').getContext('2d');
        const cumulativeChart = new Chart(ctx, chartConfig);

        function updateChartAnnotations(chart, modelLabel) {
            const annotations = [];
            infoBox.style.display = 'none';
            
            if (modelLabel.includes('Model')) {
                const breakEvenMonth = breakEvenPoints[modelLabel];
                if (breakEvenMonth) {
                    let yCost = cumulativeCostData[breakEvenMonth - 1];
                    annotations.push({
                        type: 'point',
                        xValue: labels[breakEvenMonth - 1],
                        yValue: yCost,
                        backgroundColor: 'rgba(255, 99, 132, 1)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        radius: 8,
                        label: {
                            content: 'Break-Even',
                            enabled: true,
                            position: 'start'
                        }
                    });
                }
            }

            let infoText = '';
            if (modelLabel === 'Ideal Model (3/week)') {
                infoText = `This is the **Ideal Model**. The program is a home run, becoming profitable in **Month 2**. We would immediately scale this successful model.`;
            } else if (modelLabel === 'Likely Model (2/week)') {
                infoText = `This is the **Likely Model**. The program breaks even in **Month 4**. The **Bailout Point** is Month 1, where we decide to continue and refine our training to push for better results.`;
            } else if (modelLabel === 'Poor Model (1/week)') {
                infoText = `This is the **Poor Model**. It takes until **Month 8** to break even. The **Bailout Point** is at Month 1. At this performance level, we would stop the program and leave the idea behind.`;
            } else if (modelLabel === 'Ambiguous Model') {
                infoText = `This is the **Ambiguous Model**. It shows a more realistic, sporadic performance that breaks even in **Month 4**. The **Bailout Point** is at Month 1. At this point, we would carefully analyze the initial data to see if the model has a positive trajectory.`;
            }
            
            infoBox.innerHTML = infoText;
            infoBox.style.display = 'block';
            
            chart.options.plugins.annotation.annotations = annotations;
            chart.update();
        }

        function resetChartAnnotations(chart) {
            chart.options.plugins.annotation.annotations = [];
            infoBox.style.display = 'none';
            chart.update();
        }
    </script>
</body>
</html>
